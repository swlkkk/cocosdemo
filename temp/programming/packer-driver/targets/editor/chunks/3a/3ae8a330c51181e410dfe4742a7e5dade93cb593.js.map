{"version":3,"sources":["file:///Users/swl/Desktop/cocos%E5%90%88%E9%9B%86/cocos_android/assets/scripts/GPRoundBoxSprite.ts"],"names":["_decorator","CCBoolean","CCFloat","CCInteger","cclegacy","InstanceMaterialType","Material","NodeEventType","RenderTexture","Sprite","SpriteAtlas","SpriteFrame","UIRenderer","BUILD","EDITOR","GPRoundBoxAssembler","ccclass","property","type","EventType","GPRoundBoxSprite","serializable","SizeMode","min","sizeMode","_sizeMode","value","CUSTOM","_applySpriteSize","grayscale","_useGrayscale","changeMaterialForDefine","spriteAtlas","_atlas","segments","_segments","_renderData","_flushAssembler","radius","_radius","_updateUVs","markForUpdateRenderData","spriteFrame","_spriteFrame","lastSprite","_applySpriteFrame","node","emit","SPRITE_FRAME_CHANGED","leftTop","_leftTop","resetAssembler","rightTop","_rightTop","leftBottom","_leftBottom","rightBottom","_rightBottom","onLoad","__preload","_resized","on","SIZE_CHANGED","onEnable","_activateMaterial","onDestroy","off","changeSpriteFrameFromAtlas","name","console","warn","sprite","getSpriteFrame","texture","lastInstanceMaterialType","_instanceMaterialType","TextureBase","format","getPixelFormat","PixelFormat","RGBA_ETC1","RGB_A_PVRTC_4BPPV1","RGB_A_PVRTC_2BPPV1","USE_ALPHA_SEPARATED_AND_GRAY","USE_ALPHA_SEPARATED","GRAYSCALE","ADD_COLOR_AND_TEXTURE","_updateBuiltinMaterial","mat","defines","SAMPLE_FROM_RT","passes","renderMat","initialize","effectAsset","_render","render","commitComp","renderData","_assembler","_canRender","assembler","destroyRenderData","createData","material","getRenderMaterial","updateRenderData","_updateColor","isDefault","RAW","size","originalSize","_uiProps","uiTransformComp","setContentSize","TRIMMED","rect","width","height","actualSize","contentSize","expectedW","expectedH","updateUVs","oldFrame","textureChanged","textureDirty"],"mappings":"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","sourcesContent":["import { _decorator, CCBoolean, CCFloat, CCInteger, cclegacy, InstanceMaterialType, Material, Node, NodeEventType, RenderTexture, Sprite, SpriteAtlas, SpriteFrame, UIRenderer} from 'cc';\nimport { BUILD, EDITOR } from 'cc/env';\nimport { GPRoundBoxAssembler } from './GPRoundBoxAssembler';\n\nconst { ccclass, property,type} = _decorator;\n\nenum EventType {\n    SPRITE_FRAME_CHANGED = 'spriteframe-changed',\n}\n\n@ccclass('GPRoundBoxSprite')\nexport class GPRoundBoxSprite extends UIRenderer {\n    // 尺寸模式，可以看枚举原本定义的地方有注释说明\n    @property({serializable:true})\n    protected _sizeMode = Sprite.SizeMode.TRIMMED;\n    @type(Sprite.SizeMode)\n    get sizeMode () {\n        return this._sizeMode;\n    }\n    set sizeMode (value) {\n        if (this._sizeMode === value) {\n            return;\n        }\n\n        this._sizeMode = value;\n        if (value !== Sprite.SizeMode.CUSTOM) {\n            this._applySpriteSize();\n        }\n    }\n    /**\n     * @en Grayscale mode.\n     * @zh 是否以灰度模式渲染。\n     */\n\n    @property({serializable:true})\n    protected _useGrayscale = false;\n\n    @property({type:CCBoolean})\n    get grayscale (): boolean {\n        return this._useGrayscale;\n    }\n    set grayscale (value) {\n        if (this._useGrayscale === value) {\n            return;\n        }\n        this._useGrayscale = value;\n        this.changeMaterialForDefine();\n        this[\"updateMaterial\"]();\n    }\n\n    // 图集\n    @property({serializable:true})\n    protected _atlas: SpriteAtlas | null = null;\n    @type(SpriteAtlas)\n    get spriteAtlas () {\n        return this._atlas;\n    }\n    set spriteAtlas (value) {\n        if (this._atlas === value) {\n            return;\n        }\n        this._atlas = value;\n    }\n    // 圆角用三角形模拟扇形的线段数量，越大，则越圆滑\n    @property({type:CCInteger, serializable:true})\n    _segments:number = 10\n    @property({type:CCInteger, serializable:true, min:1})\n    public get segments() {\n        return this._segments;\n    }\n    public set segments(segments) {\n        this._segments = segments;\n        this._renderData = null;\n        this._flushAssembler();\n    }\n    // 圆角半径\n    @property({type:CCFloat, serializable:true})\n    _radius:number = 20\n    @property({type:CCFloat, serializable:true, min:0})\n    public get radius() {\n        return this._radius\n    }\n    public set radius(radius) {\n        this._radius = radius;\n        this._updateUVs();\n        this.markForUpdateRenderData(true)\n    }\n\n    @property({serializable:true})\n    protected _spriteFrame: SpriteFrame | null = null;\n    @type(SpriteFrame)\n    get spriteFrame () {\n        return this._spriteFrame;\n    }\n    set spriteFrame (value) {\n        if (this._spriteFrame === value) {\n            return;\n        }\n\n        const lastSprite = this._spriteFrame;\n        this._spriteFrame = value;\n        this.markForUpdateRenderData();\n        this._applySpriteFrame(lastSprite);\n        if (EDITOR) {\n            this.node.emit(EventType.SPRITE_FRAME_CHANGED, this);\n        }\n    }\n    @property({serializable:true})\n    protected _leftTop:boolean = true;\n    @property({serializable:true})\n    get leftTop () {\n        return this._leftTop;\n    }\n    set leftTop (value:boolean) {\n        this._leftTop = value;\n        this.resetAssembler();\n    }\n    @property({serializable:true})\n    protected _rightTop:boolean = true;\n    @property({serializable:true})\n    get rightTop () {\n        return this._rightTop;\n    }\n    set rightTop (value:boolean) {\n        this._rightTop = value;\n        this.resetAssembler();\n    }\n    @property({serializable:true})\n    protected _leftBottom:boolean = true;\n    @property({serializable:true})\n    get leftBottom () {\n        return this._leftBottom;\n    }\n    set leftBottom (value:boolean) {\n        this._leftBottom = value;\n        this.resetAssembler();\n    }\n    @property({serializable:true})\n    protected _rightBottom:boolean = true;\n    @property({serializable:true})\n    get rightBottom () {\n        return this._rightBottom;\n    }\n    set rightBottom (value:boolean) {\n        this._rightBottom = value;\n        this.resetAssembler();\n    }\n    onLoad(): void {\n        super.onLoad()\n        this._flushAssembler();\n    }\n\n    public __preload () {\n        this.changeMaterialForDefine();\n        super.__preload();\n\n        if (EDITOR) {\n            this._resized();\n            this.node.on(NodeEventType.SIZE_CHANGED, this._resized, this);\n        }\n    }\n\n    public onEnable () {\n        super.onEnable();\n\n        // Force update uv, material define, active material, etc\n        this._activateMaterial();\n        const spriteFrame = this._spriteFrame;\n        if (spriteFrame) {\n            this._updateUVs();\n        }\n    }\n\n    public onDestroy () {\n        if (EDITOR) {\n            this.node.off(NodeEventType.SIZE_CHANGED, this._resized, this);\n        }\n        super.onDestroy();\n    }\n\n    /**\n     * @en\n     * Quickly switch to other sprite frame in the sprite atlas.\n     * If there is no atlas, the switch fails.\n     *\n     * @zh\n     * 选取使用精灵图集中的其他精灵。\n     * @param name @en Name of the spriteFrame to switch. @zh 要切换的 spriteFrame 名字。\n     */\n    public changeSpriteFrameFromAtlas (name: string) {\n        if (!this._atlas) {\n            console.warn('SpriteAtlas is null.');\n            return;\n        }\n        const sprite = this._atlas.getSpriteFrame(name);\n        this.spriteFrame = sprite;\n    }\n\n    /**\n     * @deprecated Since v3.7.0, this is an engine private interface that will be removed in the future.\n     */\n    public changeMaterialForDefine () {\n        let texture;\n        const lastInstanceMaterialType = this._instanceMaterialType;\n        if (this._spriteFrame) {\n            texture = this._spriteFrame.texture;\n        }\n        let value = false;\n        if (texture instanceof cclegacy.TextureBase) {\n            const format = texture.getPixelFormat();\n            value = (format === cclegacy.TextureBase.PixelFormat.RGBA_ETC1 || format === cclegacy.TextureBase.PixelFormat.RGB_A_PVRTC_4BPPV1 || format === cclegacy.TextureBase.PixelFormat.RGB_A_PVRTC_2BPPV1);\n        }\n\n        if (value && this.grayscale) {\n            this._instanceMaterialType = InstanceMaterialType.USE_ALPHA_SEPARATED_AND_GRAY;\n        } else if (value) {\n            this._instanceMaterialType = InstanceMaterialType.USE_ALPHA_SEPARATED;\n        } else if (this.grayscale) {\n            this._instanceMaterialType = InstanceMaterialType.GRAYSCALE;\n        } else {\n            this._instanceMaterialType = InstanceMaterialType.ADD_COLOR_AND_TEXTURE;\n        }\n        if (lastInstanceMaterialType !== this._instanceMaterialType) {\n            // this.updateMaterial();\n            // d.ts里没有注上这个函数，直接调用会表红。\n            this[\"updateMaterial\"]();\n        }\n    }\n\n    protected _updateBuiltinMaterial () {\n        let mat = super._updateBuiltinMaterial();\n        if (this.spriteFrame && this.spriteFrame.texture instanceof RenderTexture) {\n            const defines = { SAMPLE_FROM_RT: true, ...mat.passes[0].defines };\n            const renderMat = new Material();\n            renderMat.initialize({\n                effectAsset: mat.effectAsset,\n                defines,\n            });\n            mat = renderMat;\n        }\n        return mat;\n    }\n\n    protected _render (render) {\n        render.commitComp(this, this.renderData, this._spriteFrame, this._assembler, null);\n    }\n\n    protected _canRender () {\n        if (!super._canRender()) {\n            return false;\n        }\n\n        const spriteFrame = this._spriteFrame;\n        if (!spriteFrame || !spriteFrame.texture) {\n            return false;\n        }\n\n        return true;\n    }\n\n    protected resetAssembler() {\n        this._assembler = null;\n        this._flushAssembler();\n    }\n    protected _flushAssembler () {\n        const assembler = GPRoundBoxAssembler;\n\n        if (this._assembler !== assembler) {\n            this.destroyRenderData();\n            this._assembler = assembler;\n        }\n\n\n        if (!this._renderData) {\n            if (this._assembler && this._assembler.createData) {\n                this._renderData = this._assembler.createData(this);\n                this._renderData!.material = this.getRenderMaterial(0);\n                this.markForUpdateRenderData();\n                if (this.spriteFrame) {\n                    this._assembler.updateRenderData(this);\n                }\n                this._updateColor();\n            }\n        }\n    }\n\n    private _applySpriteSize () {\n        if (this._spriteFrame) {\n            if (BUILD || !this._spriteFrame.isDefault) {\n                if (Sprite.SizeMode.RAW === this._sizeMode) {\n                    const size = this._spriteFrame.originalSize;\n                    this.node._uiProps.uiTransformComp!.setContentSize(size);\n                } else if (Sprite.SizeMode.TRIMMED === this._sizeMode) {\n                    const rect = this._spriteFrame.rect;\n                    this.node._uiProps.uiTransformComp!.setContentSize(rect.width, rect.height);\n                }\n            }\n            this.markForUpdateRenderData(true)\n            this._assembler.updateRenderData(this);\n        }\n    }\n\n    private _resized () {\n        if (!EDITOR) {\n            return;\n        }\n\n        if (this._spriteFrame) {\n            const actualSize = this.node._uiProps.uiTransformComp!.contentSize;\n            let expectedW = actualSize.width;\n            let expectedH = actualSize.height;\n            if (this._sizeMode === Sprite.SizeMode.RAW) {\n                const size = this._spriteFrame.originalSize;\n                expectedW = size.width;\n                expectedH = size.height;\n            } else if (this._sizeMode === Sprite.SizeMode.TRIMMED) {\n                const rect = this._spriteFrame.rect;\n                expectedW = rect.width;\n                expectedH = rect.height;\n            }\n\n            if (expectedW !== actualSize.width || expectedH !== actualSize.height) {\n                this._sizeMode = Sprite.SizeMode.CUSTOM;\n            }\n        }\n    }\n\n    private _activateMaterial () {\n        const spriteFrame = this._spriteFrame;\n        const material = this.getRenderMaterial(0);\n        if (spriteFrame) {\n            if (material) {\n                this.markForUpdateRenderData();\n            }\n        }\n\n        if (this.renderData) {\n            this.renderData.material = material;\n        }\n    }\n\n    private _updateUVs () {\n        if (this._assembler) {\n            this._assembler.updateUVs(this);\n        }\n    }\n\n    private _applySpriteFrame (oldFrame: SpriteFrame | null) {\n        const spriteFrame = this._spriteFrame;\n\n        let textureChanged = false;\n        if (spriteFrame) {\n            if (!oldFrame || oldFrame.texture !== spriteFrame.texture) {\n                textureChanged = true;\n            }\n            if (textureChanged) {\n                if (this.renderData) this.renderData.textureDirty = true;\n                this.changeMaterialForDefine();\n            }\n            this._applySpriteSize();\n        }\n    }\n}"]}