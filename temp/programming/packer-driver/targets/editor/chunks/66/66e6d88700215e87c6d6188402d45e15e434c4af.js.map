{"version":3,"sources":["file:///Users/swl/Desktop/cocos%E5%90%88%E9%9B%86/cocos_android/assets/scripts/Socket/socketApi.ts"],"names":["_decorator","Component","MD5","encrypt","ccclass","property","socketApi","Md5","Enc","start","websocket_openListen","ws","data","onopen","send","websocket_messageListen","uuid","wssaltLen","callback","onmessage","e","salt","substr","url","indexOf","JSON","parse","ws_decode","websocket_errorListen","onerror","websocket_closeListen","onclose","websocket_close","close","error","console","shuffle","obj","keys","Object","newObj","sort","Math","random","forEach","key","websocket_sendMessage","message","readyState","OPEN","ws_encode","stringify","websocket_resign","_id","uid","vip","token","recordId","billId","sendData","action","user_id","user_uid","user_vip","record_id","bill_id","sign","ts","md5","websocket_sign","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, log } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { MD5 } from '../Api/MD5';\nimport { encrypt } from '../Api/encrypt';\n\n@ccclass('socketApi')\nexport class socketApi extends Component {\n    start() {\n\n    }\n    // 加密\n    Md5 = new MD5()\n    Enc = new encrypt()\n    public websocket_openListen(ws: any, data: any) {\n        ws.onopen = () => {\n            ws.send(data);\n        }\n    }\n    public websocket_messageListen(ws: any, uuid:string, wssaltLen: any, callback: any) {\n        ws.onmessage = (e: MessageEvent) => {\n            let salt = e.data.substr(0, wssaltLen)\n            if(ws.url.indexOf('nonce') != -1) {\n                callback(JSON.parse(e.data)); \n            } else {\n                callback(JSON.parse(this.Enc.ws_decode(e.data.substr(wssaltLen), uuid, salt)));\n            }\n        };\n    }\n    public websocket_errorListen(ws: any, callback: any) {\n        ws.onerror = (e: MessageEvent) => {\n            callback(e.data);\n        };\n    }\n    public websocket_closeListen(ws: any, callback: any) {\n        ws.onclose = (e: MessageEvent) => {\n            callback(e.data);\n        };\n    }\n    public websocket_close(ws: any) {\n        try {\n            ws.close();\n        } catch (error) {\n            console.error('close err');\n        }\n    }\n    shuffle(obj) {\n        const keys = Object.keys(obj)\n        const newObj = {}\n        keys.sort(() => Math.random() - 0.5).forEach((key) => {\n            newObj[key] = obj[key]\n        })\n        return newObj\n    }\n    public websocket_sendMessage(message: any, ws: any, uuid: string, salt: string) {\n        if (ws.readyState == ws.OPEN) {\n            ws.send(salt + this.Enc.ws_encode(JSON.stringify(message), uuid, salt));\n        } else {\n            return;\n        }\n    }\n    public async websocket_resign(_id, uid, vip, token, uuid, salt, recordId, billId) {\n        let sendData: any = {\n            action: 0,\n            user_id: _id,\n            user_uid: uid,\n            user_vip: vip,\n            token: token,\n            record_id: recordId,\n            bill_id: billId,\n        }\n        let sign = _id + uid + sendData.ts  + token;\n        sendData.sign = this.Md5.md5(sign);\n        sendData = salt + this.Enc.ws_encode(JSON.stringify(sendData), uuid, salt)\n        return sendData\n    }\n    public async websocket_sign(_id, uid, vip, token, uuid, salt, recordId,) {\n        let sendData: any = {\n            action: 1,\n            user_id: _id,\n            user_uid: uid,\n            user_vip: vip,\n            token: token,\n            record_id: recordId,\n        }\n        let sign = _id + uid + sendData.ts  + token;\n        sendData.sign = this.Md5.md5(sign);\n        sendData = salt + this.Enc.ws_encode(JSON.stringify(sendData), uuid, salt)\n        return sendData\n    }\n    update(deltaTime: number) {\n\n    }\n}\n\n"]}