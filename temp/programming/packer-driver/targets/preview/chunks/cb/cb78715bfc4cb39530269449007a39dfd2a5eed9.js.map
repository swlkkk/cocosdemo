{"version":3,"sources":["file:///Users/swl/Desktop/cocos/cocos_android/assets/scripts/spin.ts"],"names":["_decorator","Component","Vec3","BoxCollider","Prefab","instantiate","machine","coinCreate","lightNode","tween","ccclass","property","spin","moveLeft","moveRight","spinAc","lineNum","lineType","spints","redTimer","spinNum","start","moveSpin","node","collider","getComponent","on","onTriggerEnter","spinLight","addChild","event","Mc","parent","getChildByName","pusherControl","activeClosed","winning","isRolling","Date","now","playMusic","active","setTimeout","clearTimeout","sendData","websocketFnc","ws_spinpass","websocket","websocket_sendMessage","ws","wsuuid","wssalt","goLight","goSpinmess","ln","delLight","type","add","position","mover","to","easing","movel","then","union","repeatForever","setprize","onHandleClicked","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, BoxCollider, ITriggerEvent, Prefab, instantiate} from 'cc';\nconst { ccclass, property } = _decorator;\nimport { machine } from './machine';\nimport { coinCreate } from './coinCreate';\nimport { lightNode } from './lightNode';\nimport { tween } from '../tween';\n\n@ccclass('spin')\nexport class spin extends Component {\n    private moveLeft: Vec3 = new Vec3(-15.3, 0, 0)\n    private moveRight: Vec3 = new Vec3(15.3, 0, 0)\n    @property(Prefab)\n    spinLight: Prefab = null;\n\n    spinAc = null\n\n    // 连线奖\n    lineNum = null\n    lineType = null\n    // 经过spin的时间戳\n    spints = 0\n    redTimer = null\n    spinNum = 0\n    start() {\n        this.moveSpin(this.node)\n        let collider = this.node.getComponent(BoxCollider);\n        collider.on('onTriggerExit', this.onTriggerEnter, this);\n        if (this.spinLight != null) {\n            let spinLight = instantiate(this.spinLight);\n            this.node.addChild(spinLight)\n        };\n    }\n\n    onTriggerEnter(event: ITriggerEvent) {\n        let Mc = this.node.parent.parent.parent.parent.getChildByName('Pusher').getChildByName('Main').getChildByName('Canvas').getChildByName('Machine').getComponent(machine)\n        let pusherControl = this.node.parent.parent.parent.parent.getChildByName('Pusher').getComponent(coinCreate)\n        if (pusherControl.activeClosed) {\n            return\n        }\n        if (!pusherControl.winning) {\n            if (!Mc.isRolling) {\n                if (Date.now() - this.spints <= 200) {\n                    return;\n                }\n                pusherControl.playMusic('music/spinMs')\n                if (this.redTimer == null) {\n                    this.node.getChildByName('spinbg').getChildByName('Sprite20').active = true\n                    this.node.getChildByName('spinbg').getChildByName('Sprite21').active = true\n                    this.node.getChildByName('spinbg').getChildByName('Sprite22').active = true\n                    this.node.getChildByName('spinbg').getChildByName('Sprite23').active = true\n                    this.redTimer = setTimeout(() => {\n                        this.node.getChildByName('spinbg').getChildByName('Sprite20').active = false\n                        this.node.getChildByName('spinbg').getChildByName('Sprite21').active = false\n                        this.node.getChildByName('spinbg').getChildByName('Sprite22').active = false\n                        this.node.getChildByName('spinbg').getChildByName('Sprite23').active = false\n                        clearTimeout(this.redTimer)\n                        this.redTimer = null\n                    }, 300);\n                }\n                this.spints = Date.now()\n                let sendData = pusherControl.websocketFnc.ws_spinpass()\n                pusherControl.websocket.websocket_sendMessage(sendData, pusherControl.ws, pusherControl.wsuuid, pusherControl.wssalt)\n            } else {\n                this.spinNum++;\n                if (this.spinNum < 5) {\n                    this.goLight()\n                }\n            }\n        }\n    }\n\n    goSpinmess() {\n        let pusherControl = this.node.parent.parent.parent.parent.getChildByName('Pusher').getComponent(coinCreate)\n        let sendData = pusherControl.websocketFnc.ws_spinpass()\n        pusherControl.websocket.websocket_sendMessage(sendData, pusherControl.ws, pusherControl.wsuuid, pusherControl.wssalt)\n    }\n    goLight() {\n        let ln = this.node.parent.parent.parent.parent.getChildByName('Pusher').getChildByName('Main').getChildByName('Canvas').getChildByName('light_node').getComponent(lightNode)\n        ln.spinLight('add')\n    }\n    delLight() {\n        let ln = this.node.parent.parent.parent.parent.getChildByName('Pusher').getChildByName('Main').getChildByName('Canvas').getChildByName('light_node').getComponent(lightNode)\n        ln.spinLight('del')\n    }\n    moveSpin(node: Node, type?: boolean) {\n        Vec3.add(this.moveRight, this.moveRight, this.node.position)\n        Vec3.add(this.moveLeft, this.moveLeft, this.moveRight)\n        let mover = tween().to(1.5, { position: this.moveRight }, { easing: 'linear' })\n        let movel = tween().to(1.5, { position: this.moveLeft }, { easing: 'linear' })\n        this.spinAc = tween(node).then(mover).then(movel).union().repeatForever()\n        this.spinAc.start()\n    }\n\n    // 设置奖项\n    setprize(type: number) {\n        let Mc = this.node.parent.parent.parent.parent.getChildByName('Pusher').getChildByName('Main').getChildByName('Canvas').getChildByName('Machine').getComponent(machine)\n        if (type == 0) {\n            // 连线奖\n            if (this.lineNum == 1) {\n                Mc.onHandleClicked(5, 1);\n            } else if (this.lineNum == 2) {\n                Mc.onHandleClicked(5, 2);\n            } else if (this.lineNum == 3) {\n                Mc.onHandleClicked(5, 3);\n            }\n        } else if (type == 1) {\n            // 小玛丽\n            Mc.onHandleClicked(7);\n        } else if (type == 2) {\n            // 叠叠乐\n            Mc.onHandleClicked(6);\n        } else if (type == 3) {\n            // JP1\n            Mc.onHandleClicked(1);\n        } else if (type == 4) {\n            // JP2\n            Mc.onHandleClicked(2);\n        } else if (type == 5) {\n            // Jp3\n            Mc.onHandleClicked(3);\n        } else {\n            // 全盘奖\n            Mc.onHandleClicked(4);\n        }\n    }\n    update(deltaTime: number) {\n\n    }\n}"]}