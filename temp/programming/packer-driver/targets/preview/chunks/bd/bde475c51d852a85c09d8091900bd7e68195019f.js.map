{"version":3,"sources":["file:///Users/swl/Downloads/cocosPusher/assets/scripts/spin.ts"],"names":["_decorator","Component","tween","Vec3","BoxCollider","Prefab","instantiate","machine","coinCreate","ccclass","property","spin","moveLeft","moveRight","spinAc","lineNum","lineType","spints","redTimer","start","moveSpin","node","collider","getComponent","on","onTriggerEnter","spinLight","addChild","event","Mc","parent","getChildByName","pusherControl","winning","isRolling","Date","now","playMusic","active","setTimeout","clearTimeout","sendData","websocketFnc","ws_spinpass","websocket","websocket_sendMessage","ws","wsuuid","wssalt","add","position","mover","to","easing","movel","then","union","repeatForever","setprize","type","onHandleClicked","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, tween, Vec3, BoxCollider, ITriggerEvent, Prefab, instantiate, SpriteRenderer, SpriteFrame, resources } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { machine } from './machine';\nimport { coinCreate } from './coinCreate';\n\n@ccclass('spin')\nexport class spin extends Component {\n    private moveLeft: Vec3 = new Vec3(-15.3, 0, 0)\n    private moveRight: Vec3 = new Vec3(15.3, 0, 0)\n    @property(Prefab)\n    spinLight: Prefab = null;\n\n    spinAc = null\n\n    // 连线奖\n    lineNum = null\n    lineType = null\n    // 经过spin的时间戳\n    spints = 0\n    redTimer = null\n    start() {\n        this.moveSpin(this.node)\n        let collider = this.node.getComponent(BoxCollider);\n        collider.on('onTriggerExit', this.onTriggerEnter, this);\n        if (this.spinLight != null) {\n            let spinLight = instantiate(this.spinLight);\n            this.node.addChild(spinLight)\n        };\n    }\n\n    onTriggerEnter(event: ITriggerEvent) {\n        let Mc = this.node.parent.parent.parent.parent.getChildByName('Pusher').getChildByName('Main').getChildByName('Canvas').getChildByName('Machine').getComponent(machine)\n        let pusherControl = this.node.parent.parent.parent.parent.getChildByName('Pusher').getComponent(coinCreate)\n        if (!pusherControl.winning) {\n            if (!Mc.isRolling) {\n                if (Date.now() - this.spints <= 200) {\n                    return;\n                }\n                pusherControl.playMusic('music/spinMs')\n                if(this.redTimer == null) {\n                    this.node.getChildByName('spinbg').getChildByName('Sprite20').active = true\n                    this.node.getChildByName('spinbg').getChildByName('Sprite21').active = true\n                    this.node.getChildByName('spinbg').getChildByName('Sprite22').active = true\n                    this.node.getChildByName('spinbg').getChildByName('Sprite23').active = true\n                    this.redTimer = setTimeout(() => {\n                        this.node.getChildByName('spinbg').getChildByName('Sprite20').active = false\n                        this.node.getChildByName('spinbg').getChildByName('Sprite21').active = false\n                        this.node.getChildByName('spinbg').getChildByName('Sprite22').active = false\n                        this.node.getChildByName('spinbg').getChildByName('Sprite23').active = false\n                        clearTimeout(this.redTimer)\n                        this.redTimer = null\n                    }, 300);\n                }\n                this.spints = Date.now()\n                let sendData = pusherControl.websocketFnc.ws_spinpass()\n                pusherControl.websocket.websocket_sendMessage(sendData, pusherControl.ws, pusherControl.wsuuid, pusherControl.wssalt)\n            }\n        }\n    }\n\n    moveSpin(node: Node) {\n        Vec3.add(this.moveRight, this.moveRight, this.node.position)\n        Vec3.add(this.moveLeft, this.moveLeft, this.moveRight)\n        let mover = tween().to(1.5, { position: this.moveRight }, { easing: 'linear' })\n        let movel = tween().to(1.5, { position: this.moveLeft }, { easing: 'linear' })\n        this.spinAc = tween(node).then(mover).then(movel).union().repeatForever()\n        this.spinAc.start()\n    }\n\n    // 设置奖项\n    setprize(type: number) {\n        let Mc = this.node.parent.parent.parent.parent.getChildByName('Pusher').getChildByName('Main').getChildByName('Canvas').getChildByName('Machine').getComponent(machine)\n        if (type == 0) {\n            // 连线奖\n            if (this.lineNum == 1) {\n                Mc.onHandleClicked(5, 1);\n            } else if (this.lineNum == 2) {\n                Mc.onHandleClicked(5, 2);\n            } else if (this.lineNum == 3) {\n                Mc.onHandleClicked(5, 3);\n            }\n        } else if (type == 1) {\n            // 小玛丽\n            Mc.onHandleClicked(7);\n        } else if (type == 2) {\n            // 叠叠乐\n            Mc.onHandleClicked(6);\n        } else if (type == 3) {\n            // JP1\n            Mc.onHandleClicked(1);\n        } else if (type == 4) {\n            // JP2\n            Mc.onHandleClicked(2);\n        } else if (type == 5) {\n            // Jp3\n            Mc.onHandleClicked(3);\n        } else {\n            // 全盘奖\n            Mc.onHandleClicked(4);\n        }\n    }\n    update(deltaTime: number) {\n\n    }\n}"]}